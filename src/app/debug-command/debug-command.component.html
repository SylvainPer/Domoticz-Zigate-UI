<form [formGroup]="form">
  <ng-select
    [items]="routers"
    [multiple]="false"
    [closeOnSelect]="true"
    [searchable]="true"
    bindLabel="ZDeviceName"
    placeholder="Choose device"
    (change)="callCapabilities($event)"
    appendTo="body"
    formControlName="deviceSelected"
  >
    <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
      <span [ngOptionHighlight]="search"> <b>Name</b> : {{ item.ZDeviceName }} - <b>NwkId</b> : {{ item._NwkId }}</span>
    </ng-template>
  </ng-select>

  <ng-select
    *ngIf="form.get('deviceSelected').value"
    [items]="capabilities.Capabilities"
    [multiple]="false"
    [closeOnSelect]="true"
    [searchable]="true"
    placeholder="Choose action"
    (change)="setAction($event)"
    appendTo="body"
    formControlName="action"
  >
  </ng-select>

  <ng-select
    *ngIf="form.get('deviceSelected').value && form.get('action').value"
    [items]="capabilities.Types"
    [multiple]="false"
    [closeOnSelect]="true"
    [searchable]="true"
    placeholder="Choose type"
    appendTo="body"
    formControlName="type"
  >
  </ng-select>

  <div *ngIf="form.get('type').value === 'LvlControl'">
    <label for="level">Level</label>
    <div>
      <input type="number" min="0" formControlName="level" class="w-100" />
      <div *ngIf="form.controls['level'].errors">
        saisie incorrecte
      </div>
    </div>
  </div>

  <div>
    <button class="ml-3 btn btn-secondary" (click)="form.reset()">Cancel</button>
  </div>
  <div *ngIf="form.valid">
    <button class="ml-3 btn btn-primary" (click)="callAction()">Send</button>
  </div>
</form>
